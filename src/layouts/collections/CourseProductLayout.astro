---
// src/layouts/collections/CourseProductLayout.astro
/**
 * Course Product Layout - Landing Page Style for The Course
 *
 * For products that require user opt-in (waitlist, applications, etc.)
 * Features:
 * - OtherHero with centered gradient background (FrontPageHero style)
 * - Form section below the hero
 * - Features list with checkmarks
 * - MDX content support
 */
import BaseLayout from "@/layouts/BaseLayout.astro";
import OtherHero from "@/layouts/OtherHero.astro";
import WaitlistForm from "@/components/Form/forms/WaitlistForm.astro";
import ApplicationForm from "@/components/Form/forms/ApplicationForm.astro";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import ProductBottomCta from "@/components/ProductBottomCta.astro";
import ProductHeroHighlights from "@/components/ProductHeroHighlights.astro";
import WhopInfoNotice from "@/components/WhopInfoNotice.astro";
import type { CollectionLayoutProps } from "./types";
import { query, sortByOrder } from "@/utils/query";

const {
  entry,
  collection,
  collectionMeta,
  Content,
  isIndexPage,
  seoProps = {},
  ...extraProps
} = Astro.props as CollectionLayoutProps;

const data = entry?.data || {};
const productDescription = data.longDescription ?? data.description;
const heroHighlights = data.heroHighlights ?? [];
const productCta = data.cta ?? {};

// Form configuration
const isComingSoon = data.status === "coming-soon";
const isPremiumOffering = data.tags?.includes("premium-offering");
const isApplication = isPremiumOffering || data.price === "Apply";

const formTitle = isApplication
  ? "Apply for Mentorship"
  : isComingSoon
    ? "Join the Waitlist"
    : "Get Started";

const formDescription = isApplication
  ? "Fill out the application below. We review all applications within 48 hours."
  : isComingSoon
    ? "Be the first to know when this launches. Get early access and exclusive discounts."
    : "Enter your details to get started.";

const submitButtonText = isApplication ? "Submit Application" : "Join Waitlist";
const successMessage = isApplication
  ? "Thank you for applying! We'll review your application and get back to you within 48 hours."
  : "You're on the list! We'll notify you when we launch.";

const buttonVariant = isPremiumOffering
  ? "tertiary"
  : isComingSoon
    ? "secondary"
    : "primary";
---

<BaseLayout {...seoProps}>
  <main id="product-top" class="flex-1">
    <section class="bg-bg">
      <div class="">
        <article class="min-w-0 pb-16 md:pb-24">
          <OtherHero
            title={data.title}
            description={productDescription}
            heading={data.heading}
            image={data.bannerImage || data.featuredImage}
            price={data.price}
            priceNote={data.priceNote}
            status={data.status}
            tags={data.tags}
            className="mb-0"
          >
            <ContentRenderer
              slot="under-heading"
              query={query("authors").orderBy(sortByOrder()).limit(1)}
              variant="SmallInstructorVariant"
            />
            <WhopInfoNotice
              slot="under-description"
              text="Weâ€™ll be using Whop for enrollment, secure checkout, and member access."
            />
            <div slot="right" class="w-full max-w-[460px]">
              {
                isApplication ? (
                  <ApplicationForm
                    title={formTitle}
                    description={formDescription}
                    submitText={submitButtonText}
                    successMessage={successMessage}
                    variant={buttonVariant}
                    productName={data.title}
                    className="max-w-none"
                  />
                ) : (
                  <WaitlistForm
                    title={formTitle}
                    description={formDescription}
                    submitText={submitButtonText}
                    successMessage={successMessage}
                    variant={buttonVariant}
                    productName={data.title}
                    className="max-w-none"
                  />
                )
              }
            </div>
            {
              heroHighlights.length > 0 && (
                <ProductHeroHighlights
                  slot="under-hero-overlap"
                  items={heroHighlights}
                  className="mb-10 md:mb-14"
                />
              )
            }
          </OtherHero>

          <div class="w-90/100 mx-auto pb-16 md:pb-24">
            {
              Content ? (
                <Content />
              ) : (
                <section id="about" class="scroll-mt-36">
                  <h2 class="text-3xl md:text-4xl font-extrabold text-white mb-5">
                    About This Course
                  </h2>
                  <p class="text-text-secondary text-lg leading-relaxed max-w-[900px]">
                    {productDescription}
                  </p>
                </section>
              )
            }
          </div>
        </article>
      </div>
    </section>

    <ProductBottomCta
      eyebrow={productCta.eyebrow}
      title={productCta.title}
      description={productCta.description}
      ctaText={productCta.ctaText}
      ctaLink="#product-top"
    />
  </main>
</BaseLayout>
