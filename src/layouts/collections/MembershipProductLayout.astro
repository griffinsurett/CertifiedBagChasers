---
// src/layouts/collections/MembershipProductLayout.astro
/**
 * Membership Product Layout
 *
 * Uses the FrontPageHero for a premium landing experience.
 * Designed for subscription/community products (e.g., Discord).
 */
import BaseLayout from "@/layouts/BaseLayout.astro";
import FrontPageHeroWide from "@/layouts/FrontPageHeroWide.astro";
import Button from "@/components/Button/Button";
import SectionHeading from "@/components/SectionHeading.astro";
import type { CollectionLayoutProps } from "./types";

const {
  entry,
  collection,
  collectionMeta,
  Content,
  isIndexPage,
  seoProps = {},
  ...extraProps
} = Astro.props as CollectionLayoutProps;

const data = entry?.data || {};
const features = data.features ?? [];

const heroHeading =
  data.heading ??
  (data.title
    ? { before: "Join the", text: data.title }
    : { before: "Join the", text: "Community" });

const heroEyebrow =
  data.status === "coming-soon" ? "Coming Soon" : "Membership Access";

const primaryCTA = data.link
  ? { text: data.ctaText || "Join Now", link: data.link }
  : undefined;

const secondaryCTA = { text: "See What's Inside", link: "#membership-details" };

const cardHighlights = features.slice(0, 4);
const isExternal = primaryCTA?.link?.startsWith("http");
---

<BaseLayout {...seoProps}>
  <main class="flex-1">
    <FrontPageHeroWide
      eyebrow={heroEyebrow}
      heading={heroHeading}
      description={data.description}
      image={data.bannerImage || data.featuredImage}
      primaryCTA={primaryCTA}
      secondaryCTA={secondaryCTA}
    />

    <section id="membership-details" class="py-16 md:py-24 px-5 bg-bg">
      <div class="max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-[1.2fr_0.8fr] gap-10 lg:gap-16 items-start">
        <div>
          <SectionHeading
            eyebrow="Inside The Community"
            title="What You Get"
            description="Direct access, focused education, and a community built to compound your results."
            align="left"
          />

          {features.length > 0 && (
            <ul class="mt-8 space-y-4 text-text-secondary text-lg">
              {features.map((feature: string) => (
                <li class="flex items-start gap-3">
                  <span class="text-primary mt-1 text-lg">+</span>
                  <span>{feature}</span>
                </li>
              ))}
            </ul>
          )}

          {Content && (
            <div class="prose prose-lg prose-invert max-w-none mt-10">
              <Content />
            </div>
          )}
        </div>

        <div class="lg:sticky lg:top-24">
          <div class="rounded-2xl border border-white/10 bg-gradient-to-br from-bg-secondary via-bg to-bg-dark p-6 md:p-8 shadow-[0_30px_60px_rgba(0,0,0,0.45)]">
            <div class="text-xs uppercase tracking-[2px] text-text-dim mb-3">
              Membership Access
            </div>

            {data.price && (
              <div class="mb-4">
                <div class="text-4xl md:text-5xl font-extrabold text-white">
                  {data.price}
                </div>
                {data.priceNote && (
                  <div class="text-text-dim text-sm mt-2">
                    {data.priceNote}
                  </div>
                )}
              </div>
            )}

            {cardHighlights.length > 0 && (
              <ul class="space-y-3 text-text-secondary text-sm mb-6">
                {cardHighlights.map((item: string) => (
                  <li class="flex items-start gap-2">
                    <span class="text-accent mt-0.5">+</span>
                    <span>{item}</span>
                  </li>
                ))}
              </ul>
            )}

            {primaryCTA ? (
              <Button
                href={primaryCTA.link}
                variant="primary"
                size="lg"
                className="w-full"
                target={isExternal ? "_blank" : undefined}
                rel={isExternal ? "noopener noreferrer" : undefined}
              >
                {primaryCTA.text}
              </Button>
            ) : (
              <Button variant="secondary" size="lg" className="w-full" disabled>
                Join Now
              </Button>
            )}

            <p class="text-xs text-text-dim mt-4">
              Cancel anytime if it stops serving you.
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
