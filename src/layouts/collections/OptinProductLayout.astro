---
// src/layouts/collections/OptinProductLayout.astro
/**
 * Optin Product Layout - Landing Page Style for Products with Forms
 *
 * For products that require user opt-in (waitlist, applications, etc.)
 * Features:
 * - OtherHero with centered gradient background (FrontPageHero style)
 * - Form section below the hero
 * - Features list with checkmarks
 * - MDX content support
 */
import BaseLayout from '@/layouts/BaseLayout.astro';
import OtherHero from '@/layouts/OtherHero.astro';
import WaitlistForm from '@/components/Form/forms/WaitlistForm.astro';
import ApplicationForm from '@/components/Form/forms/ApplicationForm.astro';
import type { CollectionLayoutProps } from './types';

const {
  entry,
  collection,
  collectionMeta,
  Content,
  isIndexPage,
  seoProps = {},
  ...extraProps
} = Astro.props as CollectionLayoutProps;

const data = entry?.data || {};

// Determine form type based on product status/tags
const isComingSoon = data.status === 'coming-soon';
const isPremiumOffering = data.tags?.includes('premium-offering');
const isApplication = isPremiumOffering || data.price === 'Apply';

// Form configuration
const formTitle = isApplication
  ? 'Apply for Mentorship'
  : isComingSoon
    ? 'Join the Waitlist'
    : 'Get Started';

const formDescription = isApplication
  ? 'Fill out the application below. We review all applications within 48 hours.'
  : isComingSoon
    ? 'Be the first to know when this launches. Get early access and exclusive discounts.'
    : 'Enter your details to get started.';

const submitButtonText = isApplication ? 'Submit Application' : 'Join Waitlist';
const successMessage = isApplication
  ? "Thank you for applying! We'll review your application and get back to you within 48 hours."
  : "You're on the list! We'll notify you when we launch.";

const buttonVariant = isPremiumOffering ? "tertiary" : isComingSoon ? "secondary" : "primary";
---

<BaseLayout {...seoProps}>
  <main class="flex-1">
    {/* Hero with centered gradient background */}
    <OtherHero
      title={data.title}
      description={data.description}
      heading={data.heading}
      price={data.price}
      priceNote={data.priceNote}
      status={data.status}
      tags={data.tags}
    />

    {/* Form Section - Below Hero */}
    <section class="py-16 md:py-24 px-5 bg-bg">
      <div class="max-w-[1200px] mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-start">

          {/* Left Column - Features & Content */}
          <div>
            {/* Features List */}
            {data.features && data.features.length > 0 && (
              <div class="mb-10">
                <h2 class="text-2xl md:text-3xl font-bold text-white mb-6">
                  What's Included
                </h2>
                <ul class="space-y-4">
                  {data.features.map((feature: string) => (
                    <li class="flex items-start gap-3">
                      <span class="text-primary text-xl mt-0.5">âœ“</span>
                      <span class="text-text-secondary text-lg">{feature}</span>
                    </li>
                  ))}
                </ul>
              </div>
            )}

            {/* MDX Content */}
            {Content && (
              <div class="prose prose-lg prose-invert max-w-none">
                <Content />
              </div>
            )}
          </div>

          {/* Right Column - Form */}
          <div class="lg:sticky lg:top-24">
            {isApplication ? (
              <ApplicationForm
                title={formTitle}
                description={formDescription}
                submitText={submitButtonText}
                successMessage={successMessage}
                variant={buttonVariant}
                productName={data.title}
              />
            ) : (
              <WaitlistForm
                title={formTitle}
                description={formDescription}
                submitText={submitButtonText}
                successMessage={successMessage}
                variant={buttonVariant}
                productName={data.title}
              />
            )}
          </div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
